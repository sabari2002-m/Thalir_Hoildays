<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Destination Images - Thalir Holidays Admin</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .image-management-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .destination-item {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .destination-item h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .image-preview {
            width: 300px;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            margin: 1rem 0;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 1rem;
        }

        .image-input-group input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }

        .update-btn {
            padding: 0.8rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .update-btn:hover {
            background: var(--dark-color);
        }

        .instructions {
            background: #e7f3e7;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--primary-color);
        }

        .instructions h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .instructions ul {
            margin-left: 1.5rem;
        }

        .instructions li {
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-top">
            <div class="header-content">
                <div class="contact-info">
                    <span>üìû +91 98765 43210</span>
                    <span>‚úâÔ∏è info@thalirholidays.com</span>
                </div>
            </div>
        </div>
        <nav>
            <div class="nav-content">
                <div class="logo">
                    <img src="/images/logo.jpeg" alt="Thalir Holidays" class="logo-image">
                    <span>Thalir Holidays - Admin</span>
                </div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/admin">Dashboard</a></li>
                    <li><a href="/admin-images.html" class="active">Images</a></li>
                    <li><a href="#" onclick="adminLogout(); return false;" style="background-color: #dc3545;">Logout</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="image-management-container">
        <h1>üñºÔ∏è Manage Destination Images</h1>
        
        <div class="instructions">
            <h4>üìù How to Add Images:</h4>
            <ul>
                <li><strong>Option 1:</strong> Upload image to <code>/public/images/</code> folder (e.g., <code>ooty.jpg</code>)</li>
                <li><strong>Option 2:</strong> Use an external image URL (from Unsplash, your server, etc.)</li>
                <li><strong>Option 3:</strong> Use royalty-free images from:
                    <ul>
                        <li><a href="https://unsplash.com" target="_blank">Unsplash</a></li>
                        <li><a href="https://pexels.com" target="_blank">Pexels</a></li>
                        <li><a href="https://pixabay.com" target="_blank">Pixabay</a></li>
                    </ul>
                </li>
                <li>Right-click on image ‚Üí "Copy Image Address" ‚Üí Paste URL below</li>
            </ul>
        </div>

        <div id="destinations-list">
            <div class="loading">Loading destinations...</div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Thalir Holidays</h3>
                <p>Your trusted partner for exploring the scenic beauty and rich culture of South India.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Thalir Holidays. All rights reserved.</p>
        </div>
    </footer>

    <script src="/js/main.js"></script>
    <script>
        // Check authentication
        if (!sessionStorage.getItem('adminAuth')) {
            window.location.href = '/admin-login.html';
        }

        function adminLogout() {
            sessionStorage.removeItem('adminAuth');
            sessionStorage.removeItem('adminUser');
            window.location.href = '/admin-login.html';
        }

        async function loadDestinationsForImageManagement() {
            try {
                const response = await fetch(window.location.origin + '/api/destinations');
                const destinations = await response.json();
                displayDestinationsForImageManagement(destinations);
            } catch (error) {
                console.error('Error loading destinations:', error);
                document.getElementById('destinations-list').innerHTML = 
                    '<div class="empty-state"><h3>Error loading destinations</h3></div>';
            }
        }

        function displayDestinationsForImageManagement(destinations) {
            const container = document.getElementById('destinations-list');
            
            container.innerHTML = destinations.map(dest => `
                <div class="destination-item">
                    <h3>${dest.name}, ${dest.state}</h3>
                    
                    <div class="image-preview" id="preview-${dest.id}">
                        ${dest.image_url && !dest.image_url.includes(dest.name.toLowerCase()) 
                            ? `<img src="${dest.image_url}" alt="${dest.name}" onerror="this.parentElement.innerHTML='${getDestinationEmoji(dest.name)}'">` 
                            : getDestinationEmoji(dest.name)
                        }
                    </div>

                    <div class="image-input-group">
                        <input 
                            type="text" 
                            id="image-url-${dest.id}" 
                            placeholder="Enter image URL (e.g., /images/ooty.jpg or https://...)" 
                            value="${dest.image_url && !dest.image_url.includes(dest.name.toLowerCase()) ? dest.image_url : ''}"
                            onchange="previewImage(${dest.id}, this.value)">
                        <button class="update-btn" onclick="updateDestinationImage(${dest.id})">
                            Update Image
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function previewImage(destId, imageUrl) {
            const preview = document.getElementById(`preview-${destId}`);
            if (imageUrl.trim()) {
                preview.innerHTML = `<img src="${imageUrl}" alt="Preview" onerror="this.parentElement.innerHTML='‚ùå Invalid Image URL'">`;
            }
        }

        async function updateDestinationImage(destId) {
            const imageUrl = document.getElementById(`image-url-${destId}`).value.trim();
            
            if (!imageUrl) {
                alert('Please enter an image URL');
                return;
            }

            try {
                const response = await fetch(window.location.origin + `/api/destinations/${destId}/image`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ image_url: imageUrl })
                });

                const result = await response.json();

                if (result.success) {
                    alert('Image updated successfully!');
                    loadDestinationsForImageManagement();
                } else {
                    alert('Error updating image');
                }
            } catch (error) {
                console.error('Error updating image:', error);
                alert('Error updating image. Please try again.');
            }
        }

        // Load destinations on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDestinationsForImageManagement();
        });
    </script>
</body>
</html>
